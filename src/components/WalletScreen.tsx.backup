import React, { useState } from "react";
import { formatCurrency } from "../data";
import { createDepositRequest, createWithdrawRequest } from "../supabaseApi";

// ========== INTERFACES ==========
interface BankCard {
  id: string;
  bankName: string;
  accountNumber: string;
  accountName: string;
  isDefault: boolean;
}

interface USDTWallet {
  id: string;
  network: string;
  address: string;
  isDefault: boolean;
}

interface Transaction {
  id: string;
  type: "deposit" | "withdraw" | "reward" | "fee" | "internal";
  transactionCode: string;
  amount: number;
  time: string;
  status: "success" | "pending" | "failed";
  description: string;
}

interface FinancialData {
  totalBalance: number;
  totalDeposit: number;
  totalWithdraw: number;
  profit7Days: number;
  profit30Days: number;
  chartData: { date: string; income: number; expense: number }[];
}

interface SecuritySettings {
  twoFactorEnabled: boolean;
  emailVerified: boolean;
  phoneVerified: boolean;
  dailyLimit: number;
}

interface LoginLog {
  id: string;
  deviceName: string;
  ip: string;
  location: string;
  time: string;
  status: "success" | "failed";
}

type WalletView = "main" | "history" | "financial" | "security" | "receive" | "loginLogs" | "guide";

const WalletScreen: React.FC<{ 
  balance: number; 
  frozen: number; 
  depositPoints?: number;
  totalCommission?: number;  // ‚≠ê M·ªöI - T·ªïng hoa h·ªìng
}> = ({ balance, frozen, depositPoints = 0, totalCommission = 0 }) => {
  // ========== VIEW STATE ==========
  const [currentView, setCurrentView] = useState<WalletView>("main");
  const [showInfoModal, setShowInfoModal] = useState(false);
  
  // Balance breakdown
  const availableBalance = balance;
  const pendingBalance = 250000; // Demo data
  const frozenBalance = frozen;

  // ========== DEPOSIT & WITHDRAW ==========
  const [showDeposit, setShowDeposit] = useState(false);
  const [depositAmount, setDepositAmount] = useState("");
  const [showWithdraw, setShowWithdraw] = useState(false);
  const [withdrawAmount, setWithdrawAmount] = useState("");
  const [withdrawStep, setWithdrawStep] = useState<1 | 2>(1); // Step 1: Enter amount, Step 2: Select method
  const [selectedWithdrawMethod, setSelectedWithdrawMethod] = useState<"bank" | "usdt" | null>(null);
  const [selectedBankCard, setSelectedBankCard] = useState<string | null>(null);
  const [selectedUSDTWallet, setSelectedUSDTWallet] = useState<string | null>(null);

  // ========== BANK CARDS ==========
  const [showBankManager, setShowBankManager] = useState(false);
  const [bankCards, setBankCards] = useState<BankCard[]>([
    {
      id: "1",
      bankName: "Vietcombank",
      accountNumber: "1234567890",
      accountName: "NGUYEN VAN A",
      isDefault: true
    }
  ]);
  const [showAddBank, setShowAddBank] = useState(false);
  const [editingBank, setEditingBank] = useState<BankCard | null>(null);

  // ========== USDT WALLETS ==========
  const [showUSDTManager, setShowUSDTManager] = useState(false);
  const [usdtWallets, setUsdtWallets] = useState<USDTWallet[]>([
    {
      id: "1",
      network: "TRC20",
      address: "TXs8fK3Jx...9kL2mP4n",
      isDefault: true
    }
  ]);
  const [showAddUSDT, setShowAddUSDT] = useState(false);
  const [editingUSDT, setEditingUSDT] = useState<USDTWallet | null>(null);

  // ========== TRANSACTIONS ==========
  const [transactionFilter, setTransactionFilter] = useState<"all" | Transaction["type"]>("all");
  const [transactions] = useState<Transaction[]>([
    { id: "1", type: "deposit", transactionCode: "DEP20241202001", amount: 5000000, time: "2024-12-02 10:30", status: "success", description: "N·∫°p ti·ªÅn t·ª´ Vietcombank" },
    { id: "2", type: "withdraw", transactionCode: "WD20241201002", amount: -2000000, time: "2024-12-01 15:20", status: "success", description: "R√∫t ti·ªÅn v·ªÅ VCB" },
    { id: "3", type: "reward", transactionCode: "REW20241201003", amount: 450000, time: "2024-12-01 09:10", status: "success", description: "Hoa h·ªìng ƒë∆°n h√†ng #ORD123" },
    { id: "4", type: "fee", transactionCode: "FEE20241130004", amount: -50000, time: "2024-11-30 18:00", status: "success", description: "Ph√≠ x·ª≠ l√Ω r√∫t ti·ªÅn" },
    { id: "5", type: "internal", transactionCode: "INT20241130005", amount: 1000000, time: "2024-11-30 14:00", status: "pending", description: "Chuy·ªÉn n·ªôi b·ªô t·ª´ t√†i kho·∫£n ph·ª•" },
    { id: "6", type: "deposit", transactionCode: "DEP20241129006", amount: 3000000, time: "2024-11-29 11:25", status: "success", description: "N·∫°p USDT qua TRC20" },
  ]);

  // ========== FINANCIAL DATA ==========
  const [financialData] = useState<FinancialData>({
    totalBalance: balance,
    totalDeposit: 45600000,
    totalWithdraw: 12300000,
    profit7Days: 2340000,
    profit30Days: 8750000,
    chartData: [
      { date: "26/11", income: 1200000, expense: 500000 },
      { date: "27/11", income: 800000, expense: 300000 },
      { date: "28/11", income: 1500000, expense: 700000 },
      { date: "29/11", income: 2100000, expense: 400000 },
      { date: "30/11", income: 950000, expense: 600000 },
      { date: "01/12", income: 1800000, expense: 350000 },
      { date: "02/12", income: 2200000, expense: 800000 },
    ]
  });

  // ========== SECURITY ==========
  const [securitySettings, setSecuritySettings] = useState<SecuritySettings>({
    twoFactorEnabled: true,
    emailVerified: true,
    phoneVerified: false,
    dailyLimit: 50000000
  });

  // ========== LOGIN LOGS ==========
  const [loginLogs] = useState<LoginLog[]>([
    { id: "1", deviceName: "iPhone 14 Pro", ip: "113.161.xx.xx", location: "H·ªì Ch√≠ Minh, VN", time: "2024-12-02 08:30", status: "success" },
    { id: "2", deviceName: "Chrome on Windows", ip: "118.70.xx.xx", location: "H√† N·ªôi, VN", time: "2024-12-01 19:45", status: "success" },
    { id: "3", deviceName: "Samsung Galaxy S23", ip: "171.244.xx.xx", location: "ƒê√† N·∫µng, VN", time: "2024-11-30 12:15", status: "success" },
    { id: "4", deviceName: "Unknown Device", ip: "103.56.xx.xx", location: "Unknown", time: "2024-11-29 03:22", status: "failed" },
  ]);

  // ========== DEPOSIT LOGIC ==========
  const handleDepositClick = () => {
    setShowDeposit(true);
    setDepositAmount("");
  };

  const handleDepositConfirm = () => {
    if (!depositAmount || Number(depositAmount) < 50) {
      alert("S·ªë ti·ªÅn n·∫°p t·ªëi thi·ªÉu l√† $50 USD");
      return;
    }
    if (Number(depositAmount) > 10000) {
      alert("S·ªë ti·ªÅn n·∫°p t·ªëi ƒëa l√† $10,000 USD");
      return;
    }

    // ÔøΩ G·ª¨I Y√äU C·∫¶U N·∫†P TI·ªÄN CHO BANKER DUY·ªÜT
    const currentUser = localStorage.getItem("sclm_current_user");
    if (!currentUser) {
      alert("‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin user!");
      return;
    }

    try {
      const userData = JSON.parse(currentUser);
      console.log('üë§ User data:', userData);
      
      const depositRequest = {
        id: `DEP_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        userId: userData.id || String(userData.uid),
        username: userData.username,
        amount: Number(depositAmount),
        method: "Chuy·ªÉn kho·∫£n",
        status: "pending",
        requestTime: new Date().toISOString()
      };

      console.log('üí∞ Deposit request created:', depositRequest);

      // L∆∞u v√†o localStorage ƒë·ªÉ banker th·∫•y
      const depositRequestsKey = "sclm_deposit_requests";
      const existingRequests = localStorage.getItem(depositRequestsKey);
      const requests = existingRequests ? JSON.parse(existingRequests) : [];
      requests.push(depositRequest);
      localStorage.setItem(depositRequestsKey, JSON.stringify(requests));

      console.log('‚úÖ ƒê√£ l∆∞u deposit request v√†o localStorage. Total requests:', requests.length);

      setShowDeposit(false);
      setDepositAmount("");
      alert(`‚úÖ Y√™u c·∫ßu n·∫°p ${formatCurrency(Number(depositAmount))} ƒë√£ ƒë∆∞·ª£c g·ª≠i!\n\n‚è≥ Vui l√≤ng ch·ªù Banker duy·ªát\nüí° S·ªë d∆∞ s·∫Ω ƒë∆∞·ª£c c·ªông sau khi Banker ph√™ duy·ªát`);
    } catch (e) {
      console.error("Error creating deposit request:", e);
      alert("‚ùå L·ªói khi t·∫°o y√™u c·∫ßu n·∫°p ti·ªÅn!");
    }
  };
      // N·∫†P TI·ªÄN TR·ª∞C TI·∫æP - KH√îNG QUA BANKER
      const amount = Number(testCode);
      const currentUser = localStorage.getItem("sclm_current_user");
      if (!currentUser) {
        alert("‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin user!");
        return;
      }

      try {
        const username = JSON.parse(currentUser).username;
        const usersData = localStorage.getItem("sclm_users_v1");
        
        if (usersData) {
          const users = JSON.parse(usersData);
          const updatedUsers = users.map((u: any) => {
            if (u.username === username) {
              return {
                ...u,
                balance: (u.balance || 0) + amount,
                walletBalance: (u.walletBalance || 0) + amount
              };
            }
            return u;
          });
          
          localStorage.setItem("sclm_users_v1", JSON.stringify(updatedUsers));
          
          setShowDeposit(false);
          setDepositAmount("");
          
          alert(`‚úÖ N·∫†P TI·ªÄN TH√ÄNH C√îNG!\n\nüí∞ S·ªë ti·ªÅn: ${formatCurrency(amount)}\nÔøΩ Ch·∫ø ƒë·ªô TEST/DEMO\n‚ú® ƒê√£ c·ªông v√†o t√†i kho·∫£n!\n\nüîÑ S·ªë d∆∞ s·∫Ω c·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c.`);
          
          return;
        }
      } catch (e) {
        console.error("Error processing direct deposit:", e);
        alert("‚ùå L·ªói khi x·ª≠ l√Ω n·∫°p ti·ªÅn!");
        return;
      }
    }
    
    // N·∫øu nh·∫≠p text kh√¥ng ph·∫£i s·ªë ‚Üí B√°o l·ªói
    if (testCode.trim() !== "" && isNaN(Number(testCode))) {
      alert("‚ùå S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá!\n\nüí° Vui l√≤ng nh·∫≠p s·ªë (VD: 1000)");
      return;
    }
    
    // N·∫øu ƒë·ªÉ tr·ªëng "" ‚Üí G·ª≠i y√™u c·∫ßu cho Banker duy·ªát
    console.log('üì§ ƒêang t·∫°o deposit request...');
    const currentUser = localStorage.getItem("sclm_current_user");
    if (!currentUser) {
      alert("‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin user!");
      return;
    }

    try {
      const userData = JSON.parse(currentUser);
      console.log('üë§ User data:', userData);
      
      const depositRequest = {
        id: `DEP_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        userId: userData.id || String(userData.uid),  // S·ª≠ d·ª•ng id ho·∫∑c uid
        username: userData.username,
        amount: Number(depositAmount),
        method: "Chuy·ªÉn kho·∫£n",
        status: "pending",
        requestTime: new Date().toISOString()
      };

      console.log('üí∞ Deposit request created:', depositRequest);

      // L∆∞u v√†o localStorage ƒë·ªÉ banker th·∫•y
      const depositRequestsKey = "sclm_deposit_requests";
      const existingRequests = localStorage.getItem(depositRequestsKey);
      const requests = existingRequests ? JSON.parse(existingRequests) : [];
      requests.push(depositRequest);
      localStorage.setItem(depositRequestsKey, JSON.stringify(requests));

      console.log('‚úÖ ƒê√£ l∆∞u deposit request v√†o localStorage. Total requests:', requests.length);

      setShowDeposit(false);
      alert(`‚úÖ Y√™u c·∫ßu n·∫°p ${formatCurrency(Number(depositAmount))} ƒë√£ ƒë∆∞·ª£c g·ª≠i!\n\n‚è≥ Vui l√≤ng ch·ªù Banker duy·ªát\nüí° B·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c s·ª≠ d·ª•ng app`);
    } catch (e) {
      console.error("Error creating deposit request:", e);
      alert("‚ùå L·ªói khi t·∫°o y√™u c·∫ßu n·∫°p ti·ªÅn!");
    }
  };

  // ========== WITHDRAW LOGIC ==========
  const handleWithdrawClick = () => {
    setShowWithdraw(true);
    setWithdrawAmount("");
    setWithdrawStep(1);
    setSelectedWithdrawMethod(null);
    setSelectedBankCard(null);
    setSelectedUSDTWallet(null);
  };

  const handleWithdrawAmountConfirm = () => {
    const amount = Number(withdrawAmount);
    if (!withdrawAmount || amount <= 0) {
      alert("Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá");
      return;
    }
    if (amount < 50) {
      alert("S·ªë ti·ªÅn r√∫t t·ªëi thi·ªÉu l√† $50 USD");
      return;
    }
    if (amount > 10000) {
      alert("S·ªë ti·ªÅn r√∫t t·ªëi ƒëa l√† $10,000 USD");
      return;
    }
    if (amount > availableBalance) {
      alert("S·ªë d∆∞ kh·∫£ d·ª•ng kh√¥ng ƒë·ªß");
      return;
    }
    const dailyLimitUSD = 10000; // Daily limit in USD
    if (amount > dailyLimitUSD) {
      alert(`V∆∞·ª£t h·∫°n m·ª©c r√∫t ti·ªÅn h√†ng ng√†y (${formatCurrency(dailyLimitUSD)})`);
      return;
    }
    // Chuy·ªÉn sang b∆∞·ªõc 2: Ch·ªçn ph∆∞∆°ng th·ª©c
    setWithdrawStep(2);
  };

  const handleWithdrawMethodSelect = (method: "bank" | "usdt", itemId: string) => {
    setSelectedWithdrawMethod(method);
    if (method === "bank") {
      setSelectedBankCard(itemId);
      setSelectedUSDTWallet(null);
    } else {
      setSelectedUSDTWallet(itemId);
      setSelectedBankCard(null);
    }
  };

  const handleWithdrawFinalConfirm = () => {
    if (!selectedWithdrawMethod) {
      alert("Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c nh·∫≠n ti·ªÅn");
      return;
    }

    const method = selectedWithdrawMethod === "bank" 
      ? bankCards.find(b => b.id === selectedBankCard)?.bankName 
      : usdtWallets.find(w => w.id === selectedUSDTWallet)?.network;

    alert(`‚úÖ Y√™u c·∫ßu r√∫t ${formatCurrency(Number(withdrawAmount))} ƒë√£ ƒë∆∞·ª£c g·ª≠i!\n\nüí≥ Ph∆∞∆°ng th·ª©c: ${method}\n‚è≥ Th·ªùi gian x·ª≠ l√Ω: 1-24 gi·ªù\n\nüìß B·∫°n s·∫Ω nh·∫≠n th√¥ng b√°o qua email khi ho√†n t·∫•t.`);
    
    setShowWithdraw(false);
    setWithdrawAmount("");
    setWithdrawStep(1);
    setSelectedWithdrawMethod(null);
  };

  const handleMockClick = (action: string) => {
    window.alert(`(DEMO) Ch·ª©c nƒÉng "${action}" hi·ªán ƒëang ·ªü ch·∫ø m√¥ ph·ªèng.`);
  };

  const filteredTransactions = transactionFilter === "all" 
    ? transactions 
    : transactions.filter(t => t.type === transactionFilter);

  const getTransactionIcon = (type: Transaction["type"]) => {
    switch(type) {
      case "deposit": return "üí∞";
      case "withdraw": return "üí∏";
      case "reward": return "üéÅ";
      case "fee": return "üìã";
      case "internal": return "üîÑ";
    }
  };

  const getStatusColor = (status: Transaction["status"]) => {
    switch(status) {
      case "success": return "text-green-600 bg-green-50";
      case "pending": return "text-yellow-600 bg-yellow-50";
      case "failed": return "text-red-600 bg-red-50";
    }
  };

  const getStatusText = (status: Transaction["status"]) => {
    switch(status) {
      case "success": return "Th√†nh c√¥ng";
      case "pending": return "ƒêang x·ª≠ l√Ω";
      case "failed": return "Th·∫•t b·∫°i";
    }
  };

  // ========== RENDER VIEWS ==========
  if (currentView === "history") {
    return <TransactionHistoryView 
      transactions={filteredTransactions}
      filter={transactionFilter}
      onFilterChange={setTransactionFilter}
      onBack={() => setCurrentView("main")}
      getTransactionIcon={getTransactionIcon}
      getStatusColor={getStatusColor}
      getStatusText={getStatusText}
    />;
  }

  if (currentView === "financial") {
    return <FinancialOverviewView 
      data={financialData}
      onBack={() => setCurrentView("main")}
    />;
  }

  if (currentView === "security") {
    return <SecurityCenterView 
      settings={securitySettings}
      onUpdate={setSecuritySettings}
      onBack={() => setCurrentView("main")}
    />;
  }

  if (currentView === "receive") {
    return <ReceiveInfoView 
      bankCards={bankCards}
      usdtWallets={usdtWallets}
      onBack={() => setCurrentView("main")}
    />;
  }

  if (currentView === "loginLogs") {
    return <LoginLogsView 
      logs={loginLogs}
      onBack={() => setCurrentView("main")}
    />;
  }

  if (currentView === "guide") {
    return <GuideView onBack={() => setCurrentView("main")} />;
  }

  // ========== MAIN VIEW ==========
  return (
    <div className="flex-1 overflow-y-auto pb-24">
      <div className="p-4 pb-3">
        <div className="flex items-center justify-between mb-3">
          <div>
            <p className="text-[11px] text-slate-300">Xin ch√†o!</p>
            <p className="text-xs font-semibold text-slate-50">Demo</p>
          </div>
          <div className="flex items-center gap-3 text-[11px] text-slate-300">
            <button 
              className="h-7 w-7 rounded-full bg-slate-800 flex items-center justify-center" 
              onClick={() => handleMockClick("Th√¥ng b√°o v√≠")}
              aria-label="Th√¥ng b√°o v√≠"
            >
              <span className="text-[15px]">üîî</span>
            </button>
          </div>
        </div>

        {/* Balance Card with Breakdown */}
        <div className="rounded-3xl bg-gradient-to-r from-indigo-400 via-sky-300 to-pink-300 px-4 py-3 text-slate-900 shadow-xl">
          <div className="flex items-center justify-between text-[11px] mb-2">
            <span>T·ªïng s·ªë d∆∞</span>
            <span>T√≠ch l≈©y n·∫°p</span>
          </div>
          <div className="flex items-center justify-between mb-3">
            <p className="text-base font-extrabold">{formatCurrency(balance)}</p>
            <p className="text-sm font-semibold opacity-80">{formatCurrency(depositPoints)}</p>
          </div>

          {/* Balance Breakdown */}
          <div className="grid grid-cols-3 gap-2 pt-2 border-t border-slate-900/10">
            <div>
              <p className="text-[9px] opacity-70">Kh·∫£ d·ª•ng</p>
              <p className="text-[11px] font-semibold">{formatCurrency(availableBalance)}</p>
            </div>
            <div>
              <p className="text-[9px] opacity-70">ƒêang ch·ªù</p>
              <p className="text-[11px] font-semibold">{formatCurrency(pendingBalance)}</p>
            </div>
            <div>
              <p className="text-[9px] opacity-70">T·∫°m kh√≥a</p>
              <p className="text-[11px] font-semibold">{formatCurrency(frozenBalance)}</p>
            </div>
          </div>
        </div>
      </div>

      <section className="px-4">
        <div className="grid grid-cols-4 gap-2 mb-4">
          {/* N·∫°p Ti·ªÅn */}
          <button 
            onClick={handleDepositClick}
            className="flex flex-col items-center justify-center rounded-2xl bg-slate-900/80 border border-white/5 py-2.5 text-[10px] text-slate-100"
          >
            <div className="h-10 w-10 mb-1">
              <img src="/icon-deposit.svg" alt="N·∫°p ti·ªÅn" className="w-full h-full" />
            </div>
            <span>N·∫°p Ti·ªÅn</span>
          </button>

          {/* R√∫t Ti·ªÅn */}
          <button 
            onClick={handleWithdrawClick}
            className="flex flex-col items-center justify-center rounded-2xl bg-slate-900/80 border border-white/5 py-2.5 text-[10px] text-slate-100"
          >
            <div className="h-10 w-10 mb-1">
              <img src="/icon-withdraw.svg" alt="R√∫t ti·ªÅn" className="w-full h-full" />
            </div>
            <span>R√∫t Ti·ªÅn</span>
          </button>

          {/* Chi ti·∫øt */}
          <button 
            onClick={() => handleMockClick("Chi ti·∫øt")}
            className="flex flex-col items-center justify-center rounded-2xl bg-slate-900/80 border border-white/5 py-2.5 text-[10px] text-slate-100"
          >
            <div className="h-8 w-8 rounded-2xl bg-slate-800 flex items-center justify-center mb-1">
              <span className="text-[15px]">üìÑ</span>
            </div>
            <span>Chi ti·∫øt</span>
          </button>

          {/* C·∫•p */}
          <button 
            onClick={() => handleMockClick("C·∫•p")}
            className="flex flex-col items-center justify-center rounded-2xl bg-slate-900/80 border border-white/5 py-2.5 text-[10px] text-slate-100"
          >
            <div className="h-8 w-8 rounded-2xl bg-slate-800 flex items-center justify-center mb-1">
              <span className="text-[15px]">üéñÔ∏è</span>
            </div>
            <span>C·∫•p</span>
          </button>
        </div>
        {/* Compact trust card under quick actions */}
        <div className="mt-3 rounded-2xl bg-white/3 p-3 text-[12px] text-slate-200">
          <div className="grid grid-cols-2 gap-2 mb-2 text-[11px]">
            <div>
              <div className="opacity-70">ƒê∆°n v·ªã trung gian</div>
              <div className="font-semibold">SCLM Global</div>
            </div>
            <div>
              <div className="opacity-70">Tr·∫°ng th√°i c·ª≠a h√†ng</div>
              <div className="font-semibold">ƒêang k√≠ch ho·∫°t</div>
            </div>
            <div>
              <div className="opacity-70">M·ª©c b·∫£o v·ªá</div>
              <div className="font-semibold">Chu·∫©n</div>
            </div>
            <div>
              <div className="opacity-70">Li√™n k·∫øt ng√¢n h√†ng</div>
              <div className="font-semibold">ƒê√£ x√°c minh</div>
            </div>
          </div>
          <div className="flex items-center justify-between">
            <button onClick={() => setShowInfoModal(true)} className="text-sm px-3 py-1 rounded-full bg-slate-800/60">Xem chi ti·∫øt</button>
            <div className="text-[11px] opacity-70">H·ªó tr·ª£ 24/7</div>
          </div>
        </div>

        {/* Feature Menu - New Section */}
        <div className="mt-4">
          <h3 className="text-xs font-semibold text-slate-300 mb-3 px-1">Qu·∫£n l√Ω & Ti·ªán √≠ch</h3>
          <div className="grid grid-cols-2 gap-3">
            {/* Transaction History */}
            <button 
              onClick={() => setCurrentView("history")}
              className="rounded-2xl bg-slate-900/60 p-4 text-left border border-white/5"
            >
              <div className="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center mb-2">
                <span className="text-xl">üìú</span>
              </div>
              <p className="text-sm font-semibold text-slate-100">L·ªãch s·ª≠ GD</p>
              <p className="text-[10px] text-slate-400 mt-0.5">Xem chi ti·∫øt</p>
            </button>

            {/* Financial Overview */}
            <button 
              onClick={() => setCurrentView("financial")}
              className="rounded-2xl bg-slate-900/60 p-4 text-left border border-white/5"
            >
              <div className="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center mb-2">
                <span className="text-xl">üìä</span>
              </div>
              <p className="text-sm font-semibold text-slate-100">B√°o c√°o TC</p>
              <p className="text-[10px] text-slate-400 mt-0.5">Thu chi & l√£i</p>
            </button>

            {/* Security Center */}
            <button 
              onClick={() => setCurrentView("security")}
              className="rounded-2xl bg-slate-900/60 p-4 text-left border border-white/5"
            >
              <div className="w-10 h-10 rounded-xl bg-red-500/20 flex items-center justify-center mb-2">
                <span className="text-xl">üîê</span>
              </div>
              <p className="text-sm font-semibold text-slate-100">B·∫£o m·∫≠t</p>
              <p className="text-[10px] text-slate-400 mt-0.5">2FA & X√°c minh</p>
            </button>

            {/* Receive Info */}
            <button 
              onClick={() => setCurrentView("receive")}
              className="rounded-2xl bg-slate-900/60 p-4 text-left border border-white/5"
            >
              <div className="w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center mb-2">
                <span className="text-xl">üì≤</span>
              </div>
              <p className="text-sm font-semibold text-slate-100">Nh·∫≠n ti·ªÅn</p>
              <p className="text-[10px] text-slate-400 mt-0.5">Chia s·∫ª TK</p>
            </button>

            {/* Login Logs */}
            <button 
              onClick={() => setCurrentView("loginLogs")}
              className="rounded-2xl bg-slate-900/60 p-4 text-left border border-white/5"
            >
              <div className="w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center mb-2">
                <span className="text-xl">üîç</span>
              </div>
              <p className="text-sm font-semibold text-slate-100">Nh·∫≠t k√Ω</p>
              <p className="text-[10px] text-slate-400 mt-0.5">ƒêƒÉng nh·∫≠p</p>
            </button>

            {/* Guide */}
            <button 
              onClick={() => setCurrentView("guide")}
              className="rounded-2xl bg-slate-900/60 p-4 text-left border border-white/5"
            >
              <div className="w-10 h-10 rounded-xl bg-yellow-500/20 flex items-center justify-center mb-2">
                <span className="text-xl">üìñ</span>
              </div>
              <p className="text-sm font-semibold text-slate-100">H∆∞·ªõng d·∫´n</p>
              <p className="text-[10px] text-slate-400 mt-0.5">N·∫°p & R√∫t</p>
            </button>
          </div>
        </div>

        {/* Payment Methods */}
        <div className="mt-4">
          <h3 className="text-xs font-semibold text-slate-300 mb-3 px-1">Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
          <div className="space-y-3">
            {/* Bank Cards Management */}
            <button 
              onClick={() => setShowBankManager(true)}
              className="w-full rounded-2xl bg-slate-900/60 p-4 text-left border border-white/5"
            >
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center">
                    <span className="text-xl">üè¶</span>
                  </div>
                  <div>
                    <p className="text-sm font-semibold text-slate-100">Qu·∫£n l√Ω th·∫ª ng√¢n h√†ng</p>
                    <p className="text-xs text-slate-400">{bankCards.length} th·∫ª ƒë√£ li√™n k·∫øt</p>
                  </div>
                </div>
                <svg className="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </button>

            {/* USDT Wallets Management */}
            <button 
              onClick={() => setShowUSDTManager(true)}
              className="w-full rounded-2xl bg-slate-900/60 p-4 text-left border border-white/5"
            >
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center">
                    <span className="text-xl">üí∞</span>
                  </div>
                  <div>
                    <p className="text-sm font-semibold text-slate-100">Qu·∫£n l√Ω V√≠ USDT</p>
                    <p className="text-xs text-slate-400">{usdtWallets.length} v√≠ ƒë√£ li√™n k·∫øt</p>
                  </div>
                </div>
                <svg className="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </button>
          </div>
        </div>
      </section>

      {/* Bank Cards Manager Modal */}
      {showBankManager && (
        <div className="fixed inset-0 z-40 bg-slate-100 overflow-y-auto">
          <div className="sticky top-0 z-10 bg-white border-b border-slate-200">
            <div className="flex items-center gap-3 px-4 py-4">
              <button 
                onClick={() => setShowBankManager(false)}
                className="w-8 h-8 flex items-center justify-center"
                aria-label="Quay l·∫°i"
              >
                <svg className="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
              </button>
              <h1 className="text-lg font-semibold text-slate-900">Qu·∫£n l√Ω th·∫ª ng√¢n h√†ng</h1>
            </div>
          </div>

          <div className="p-4 space-y-3">
            {bankCards.map((card) => (
              <div key={card.id} className="rounded-xl bg-white p-4 shadow-sm border border-slate-200">
                <div className="flex items-start justify-between mb-3">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="text-sm font-semibold text-slate-900">{card.bankName}</p>
                      {card.isDefault && (
                        <span className="text-[9px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 font-medium">M·∫∑c ƒë·ªãnh</span>
                      )}
                    </div>
                    <p className="text-xs text-slate-600">{card.accountName}</p>
                    <p className="text-xs text-slate-500 font-mono mt-1">{card.accountNumber}</p>
                  </div>
                  <button 
                    onClick={() => setEditingBank(card)}
                    className="text-blue-600 text-xs"
                  >
                    S·ª≠a
                  </button>
                </div>
                <div className="flex gap-2">
                  {!card.isDefault && (
                    <button 
                      onClick={() => {
                        setBankCards(bankCards.map(c => ({ ...c, isDefault: c.id === card.id })));
                      }}
                      className="flex-1 py-2 rounded-lg bg-slate-100 text-slate-700 text-xs font-medium"
                    >
                      ƒê·∫∑t m·∫∑c ƒë·ªãnh
                    </button>
                  )}
                  <button 
                    onClick={() => {
                      if (window.confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a th·∫ª n√†y?')) {
                        setBankCards(bankCards.filter(c => c.id !== card.id));
                      }
                    }}
                    className="flex-1 py-2 rounded-lg bg-red-50 text-red-600 text-xs font-medium"
                  >
                    X√≥a
                  </button>
                </div>
              </div>
            ))}

            <button 
              onClick={() => setShowAddBank(true)}
              className="w-full py-3 rounded-xl bg-blue-500 text-white font-semibold text-sm"
            >
              + Th√™m th·∫ª ng√¢n h√†ng
            </button>
          </div>
        </div>
      )}

      {/* USDT Wallets Manager Modal */}
      {showUSDTManager && (
        <div className="fixed inset-0 z-40 bg-slate-100 overflow-y-auto">
          <div className="sticky top-0 z-10 bg-white border-b border-slate-200">
            <div className="flex items-center gap-3 px-4 py-4">
              <button 
                onClick={() => setShowUSDTManager(false)}
                className="w-8 h-8 flex items-center justify-center"
                aria-label="Quay l·∫°i"
              >
                <svg className="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
              </button>
              <h1 className="text-lg font-semibold text-slate-900">Qu·∫£n l√Ω V√≠ USDT</h1>
            </div>
          </div>

          <div className="p-4 space-y-3">
            {usdtWallets.map((wallet) => (
              <div key={wallet.id} className="rounded-xl bg-white p-4 shadow-sm border border-slate-200">
                <div className="flex items-start justify-between mb-3">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="text-sm font-semibold text-slate-900">{wallet.network}</p>
                      {wallet.isDefault && (
                        <span className="text-[9px] px-2 py-0.5 rounded-full bg-green-100 text-green-700 font-medium">M·∫∑c ƒë·ªãnh</span>
                      )}
                    </div>
                    <p className="text-xs text-slate-600 font-mono break-all">{wallet.address}</p>
                  </div>
                  <button 
                    onClick={() => setEditingUSDT(wallet)}
                    className="text-blue-600 text-xs"
                  >
                    S·ª≠a
                  </button>
                </div>
                <div className="flex gap-2">
                  {!wallet.isDefault && (
                    <button 
                      onClick={() => {
                        setUsdtWallets(usdtWallets.map(w => ({ ...w, isDefault: w.id === wallet.id })));
                      }}
                      className="flex-1 py-2 rounded-lg bg-slate-100 text-slate-700 text-xs font-medium"
                    >
                      ƒê·∫∑t m·∫∑c ƒë·ªãnh
                    </button>
                  )}
                  <button 
                    onClick={() => {
                      if (window.confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a v√≠ n√†y?')) {
                        setUsdtWallets(usdtWallets.filter(w => w.id !== wallet.id));
                      }
                    }}
                    className="flex-1 py-2 rounded-lg bg-red-50 text-red-600 text-xs font-medium"
                  >
                    X√≥a
                  </button>
                </div>
              </div>
            ))}

            <button 
              onClick={() => setShowAddUSDT(true)}
              className="w-full py-3 rounded-xl bg-green-500 text-white font-semibold text-sm"
            >
              + Th√™m V√≠ USDT
            </button>
          </div>
        </div>
      )}

      {/* Deposit Modal */}
      {showDeposit && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4">
          <div className="w-full max-w-sm rounded-2xl bg-white p-4 shadow-xl">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-base font-semibold text-slate-900">N·∫°p ti·ªÅn v√†o v√≠</h3>
              <button onClick={() => setShowDeposit(false)} className="text-slate-400 text-lg" aria-label="ƒê√≥ng">‚úï</button>
            </div>

            <div className="mb-3">
              <label className="block text-xs font-medium text-slate-600 mb-1.5">
                S·ªë ti·ªÅn mu·ªën n·∫°p (USD)
              </label>
              <input
                type="number"
                value={depositAmount}
                onChange={(e) => setDepositAmount(e.target.value)}
                placeholder="VD: 500"
                className="w-full px-3 py-2 rounded-lg border border-slate-300 bg-white text-slate-900 text-sm font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                min="50"
                max="10000"
              />
              <p className="text-[10px] text-slate-500 mt-1">T·ªëi thi·ªÉu: $50 ‚Ä¢ T·ªëi ƒëa: $10,000</p>
            </div>

            {/* Quick Amount Buttons */}
            <div className="grid grid-cols-3 gap-1.5 mb-3">
              {[50, 100, 200, 500, 1000, 5000].map(amount => (
                <button
                  key={amount}
                  onClick={() => setDepositAmount(amount.toString())}
                  className="py-1.5 rounded-lg bg-slate-100 text-slate-700 text-[11px] font-medium hover:bg-blue-100"
                >
                  ${amount}
                </button>
              ))}
            </div>

            <div className="rounded-lg bg-blue-50 p-2.5 mb-3">
              <p className="text-[10px] text-blue-900 font-medium mb-1">üí° L∆∞u √Ω:</p>
              <ul className="text-[10px] text-blue-800 space-y-0.5">
                <li>‚Ä¢ Sau khi x√°c nh·∫≠n, b·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn CSKH</li>
                <li>‚Ä¢ CSKH s·∫Ω h∆∞·ªõng d·∫´n ho√†n t·∫•t giao d·ªãch</li>
                <li>‚Ä¢ Th·ªùi gian x·ª≠ l√Ω: 5-15 ph√∫t</li>
              </ul>
            </div>

            <div className="flex gap-2">
              <button
                onClick={() => setShowDeposit(false)}
                className="flex-1 py-2 rounded-lg bg-slate-200 text-slate-700 text-sm font-medium"
              >
                H·ªßy
              </button>
              <button
                onClick={handleDepositConfirm}
                className="flex-1 py-2 rounded-lg bg-blue-500 text-white text-sm font-medium"
              >
                X√°c nh·∫≠n n·∫°p
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Withdraw Modal */}
      {showWithdraw && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4">
          <div className="w-full max-w-sm rounded-2xl bg-white p-4 shadow-xl max-h-[85vh] overflow-y-auto">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-base font-semibold text-slate-900">
                {withdrawStep === 1 ? "R√∫t ti·ªÅn t·ª´ v√≠" : "Ch·ªçn ph∆∞∆°ng th·ª©c"}
              </h3>
              <button 
                onClick={() => setShowWithdraw(false)} 
                className="text-slate-400 text-lg"
                aria-label="ƒê√≥ng"
              >‚úï</button>
            </div>

            {/* Step 1: Enter Amount */}
            {withdrawStep === 1 && (
              <>
                <div className="mb-3">
                  <label className="block text-xs font-medium text-slate-600 mb-1.5">
                    S·ªë ti·ªÅn mu·ªën r√∫t (USD)
                  </label>
                  <input
                    type="number"
                    value={withdrawAmount}
                    onChange={(e) => setWithdrawAmount(e.target.value)}
                    placeholder="VD: 100"
                    className="w-full px-3 py-2 rounded-lg border border-slate-300 bg-white text-slate-900 text-sm font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500"
                    min="50"
                    max="10000"
                  />
                  <div className="flex justify-between items-center mt-1">
                    <p className="text-[10px] text-slate-500">T·ªëi thi·ªÉu: $50 ‚Ä¢ T·ªëi ƒëa: $10,000</p>
                    <p className="text-[10px] text-green-600 font-medium">
                      Kh·∫£ d·ª•ng: {formatCurrency(availableBalance)}
                    </p>
                  </div>
                </div>

                {/* Quick Amount Buttons */}
                <div className="grid grid-cols-3 gap-1.5 mb-3">
                  {[50, 100, 200, 500, 1000, 5000].map(amount => (
                    <button
                      key={amount}
                      onClick={() => setWithdrawAmount(amount.toString())}
                      disabled={amount > availableBalance}
                      className={`py-1.5 rounded-lg text-[11px] font-medium ${
                        amount > availableBalance
                          ? "bg-slate-100 text-slate-400 cursor-not-allowed"
                          : "bg-slate-100 text-slate-700 hover:bg-green-100"
                      }`}
                    >
                      ${amount}
                    </button>
                  ))}
                  <button
                    onClick={() => setWithdrawAmount(Math.min(10000, availableBalance).toString())}
                    className="py-1.5 rounded-lg bg-green-100 text-green-700 text-[11px] font-medium"
                  >
                    T·ªëi ƒëa
                  </button>
                </div>

                <div className="rounded-lg bg-yellow-50 p-2.5 mb-3">
                  <p className="text-[10px] text-yellow-900 font-medium mb-1">‚ö†Ô∏è L∆∞u √Ω:</p>
                  <ul className="text-[10px] text-yellow-800 space-y-0.5">
                    <li>‚Ä¢ H·∫°n m·ª©c/ng√†y: $10,000</li>
                    <li>‚Ä¢ Th·ªùi gian x·ª≠ l√Ω: 1-24 gi·ªù</li>
                    <li>‚Ä¢ Ph√≠ r√∫t ti·ªÅn: 0% (Mi·ªÖn ph√≠)</li>
                  </ul>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => setShowWithdraw(false)}
                    className="flex-1 py-2 rounded-lg bg-slate-200 text-slate-700 text-sm font-medium"
                  >
                    H·ªßy
                  </button>
                  <button
                    onClick={handleWithdrawAmountConfirm}
                    className="flex-1 py-2 rounded-lg bg-green-500 text-white text-sm font-medium"
                  >
                    Ti·∫øp t·ª•c ‚Üí
                  </button>
                </div>
              </>
            )}

            {/* Step 2: Select Payment Method */}
            {withdrawStep === 2 && (
              <>
                <div className="mb-3">
                  <div className="rounded-lg bg-green-50 p-2.5 mb-3">
                    <p className="text-xs text-green-900 font-semibold">
                      S·ªë ti·ªÅn r√∫t: {formatCurrency(Number(withdrawAmount))}
                    </p>
                  </div>

                  <p className="text-xs font-medium text-slate-700 mb-2">
                    Ch·ªçn t√†i kho·∫£n/v√≠ nh·∫≠n ti·ªÅn:
                  </p>

                  {/* Bank Cards */}
                  {bankCards.length > 0 && (
                    <div className="mb-3">
                      <p className="text-[10px] text-slate-500 mb-1.5">üè¶ Th·∫ª ng√¢n h√†ng</p>
                      <div className="space-y-1.5">
                        {bankCards.map(card => (
                          <button
                            key={card.id}
                            onClick={() => handleWithdrawMethodSelect("bank", card.id)}
                            className={`w-full p-2.5 rounded-lg border-2 text-left transition-all ${
                              selectedBankCard === card.id
                                ? "border-blue-500 bg-blue-50"
                                : "border-slate-200 bg-white hover:border-blue-300"
                            }`}
                          >
                            <div className="flex items-center justify-between">
                              <div className="flex-1 min-w-0">
                                <p className="text-xs font-semibold text-slate-900">
                                  {card.bankName}
                                </p>
                                <p className="text-[10px] text-slate-600 font-mono">{card.accountNumber}</p>
                                <p className="text-[10px] text-slate-500 truncate">{card.accountName}</p>
                              </div>
                              {selectedBankCard === card.id && (
                                <span className="text-blue-600 text-lg ml-2">‚úì</span>
                              )}
                            </div>
                          </button>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* USDT Wallets */}
                  {usdtWallets.length > 0 && (
                    <div>
                      <p className="text-[10px] text-slate-500 mb-1.5">üí∞ V√≠ USDT</p>
                      <div className="space-y-1.5">
                        {usdtWallets.map(wallet => (
                          <button
                            key={wallet.id}
                            onClick={() => handleWithdrawMethodSelect("usdt", wallet.id)}
                            className={`w-full p-2.5 rounded-lg border-2 text-left transition-all ${
                              selectedUSDTWallet === wallet.id
                                ? "border-green-500 bg-green-50"
                                : "border-slate-200 bg-white hover:border-green-300"
                            }`}
                          >
                            <div className="flex items-center justify-between">
                              <div className="flex-1 min-w-0">
                                <p className="text-xs font-semibold text-slate-900">
                                  {wallet.network}
                                </p>
                                <p className="text-[10px] text-slate-600 font-mono break-all">{wallet.address}</p>
                              </div>
                              {selectedUSDTWallet === wallet.id && (
                                <span className="text-green-600 text-lg ml-2">‚úì</span>
                              )}
                            </div>
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => setWithdrawStep(1)}
                    className="flex-1 py-2 rounded-lg bg-slate-200 text-slate-700 text-sm font-medium"
                  >
                    ‚Üê Quay l·∫°i
                  </button>
                  <button
                    onClick={handleWithdrawFinalConfirm}
                    disabled={!selectedWithdrawMethod}
                    className={`flex-1 py-2 rounded-lg text-sm font-medium ${
                      selectedWithdrawMethod
                        ? "bg-green-500 text-white"
                        : "bg-slate-300 text-slate-500 cursor-not-allowed"
                    }`}
                  >
                    X√°c nh·∫≠n r√∫t
                  </button>
                </div>
              </>
            )}
          </div>
        </div>
      )}

      {showInfoModal && (
        <div className="fixed inset-0 z-40 flex items-center justify-center bg-black/60 px-4">
          <div className="w-full max-w-md rounded-2xl bg-white text-slate-900 p-4 shadow-xl">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-lg font-semibold">Th√¥ng tin trung gian & h·ªó tr·ª£</h3>
              <button onClick={() => setShowInfoModal(false)} className="text-slate-500">‚úï</button>
            </div>
            <div className="space-y-3 text-sm text-slate-700">
              <div>
                <div className="font-semibold">Th√¥ng tin ph√°p l√Ω & minh b·∫°ch</div>
                <div className="text-[13px] mt-1">ƒê∆°n v·ªã trung gian: SCLM Global ‚Äì Ti·∫øp nh·∫≠n & x·ª≠ l√Ω th√¥ng tin theo quy tr√¨nh chu·∫©n. M√£ ƒëƒÉng k√Ω ho·∫°t ƒë·ªông: (‚Ä¶)</div>
              </div>

              <div>
                <div className="font-semibold">X√°c minh ‚Äì Ki·ªÉm ch·ª©ng c·ª≠a h√†ng</div>
                <ul className="list-disc pl-5 mt-1 text-[13px]">
                  <li>Tr·∫°ng th√°i c·ª≠a h√†ng: ƒêang k√≠ch ho·∫°t</li>
                  <li>M·ª©c b·∫£o v·ªá t√†i kho·∫£n: Chu·∫©n</li>
                  <li>Li√™n k·∫øt t√†i kho·∫£n ng√¢n h√†ng: ƒê√£ x√°c minh</li>
                </ul>
              </div>

              <div>
                <div className="font-semibold">An to√†n & H·ªó tr·ª£</div>
                <ul className="list-disc pl-5 mt-1 text-[13px]">
                  <li>C·∫£nh b√°o r·ªßi ro: Kh√¥ng c√≥</li>
                  <li>Trung t√¢m h·ªó tr·ª£: Zalo, Hotline, Email</li>
                  <li>Theo d√µi giao d·ªãch: Log an to√†n s·∫µn s√†ng</li>
                </ul>
              </div>

              <div>
                <div className="font-semibold">Ngu·ªìn d·ªØ li·ªáu ti·∫øp nh·∫≠n</div>
                <div className="text-[13px] mt-1">D·ªØ li·ªáu nh·∫≠n t·ª´: S√†n th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠ ¬∑ Lo·∫°i d·ªØ li·ªáu: m√£ ƒë∆°n, s·∫£n ph·∫©m, tr·∫°ng th√°i, th·ªùi gian.</div>
              </div>
            </div>
            <div className="mt-4 flex justify-end">
              <button onClick={() => setShowInfoModal(false)} className="px-3 py-2 rounded-full bg-slate-100 text-slate-700">ƒê√≥ng</button>
            </div>
          </div>
        </div>
      )}

      {/* Add/Edit Bank Card Form */}
      {(showAddBank || editingBank) && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4">
          <div className="w-full max-w-md rounded-2xl bg-white p-5 shadow-xl">
            <h3 className="text-lg font-semibold text-slate-900 mb-4">
              {editingBank ? 'S·ª≠a th·∫ª ng√¢n h√†ng' : 'Th√™m th·∫ª ng√¢n h√†ng'}
            </h3>
            <form onSubmit={(e) => {
              e.preventDefault();
              const formData = new FormData(e.currentTarget);
              const newCard: BankCard = {
                id: editingBank?.id || Date.now().toString(),
                bankName: formData.get('bankName') as string,
                accountNumber: formData.get('accountNumber') as string,
                accountName: formData.get('accountName') as string,
                isDefault: bankCards.length === 0 || (formData.get('isDefault') === 'on')
              };
              
              if (editingBank) {
                setBankCards(bankCards.map(c => c.id === editingBank.id ? newCard : (newCard.isDefault ? {...c, isDefault: false} : c)));
              } else {
                setBankCards([...bankCards.map(c => newCard.isDefault ? {...c, isDefault: false} : c), newCard]);
              }
              setShowAddBank(false);
              setEditingBank(null);
            }} className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">T√™n ng√¢n h√†ng</label>
                <input
                  name="bankName"
                  type="text"
                  required
                  defaultValue={editingBank?.bankName}
                  placeholder="VD: Vietcombank, TPBank..."
                  className="w-full px-3 py-2 rounded-lg border border-slate-300 bg-white text-slate-900 text-sm font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">S·ªë t√†i kho·∫£n</label>
                <input
                  name="accountNumber"
                  type="text"
                  required
                  defaultValue={editingBank?.accountNumber}
                  placeholder="VD: 1234567890"
                  className="w-full px-3 py-2 rounded-lg border border-slate-300 bg-white text-slate-900 text-sm font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">T√™n ch·ªß t√†i kho·∫£n</label>
                <input
                  name="accountName"
                  type="text"
                  required
                  defaultValue={editingBank?.accountName}
                  placeholder="VD: NGUYEN VAN A"
                  className="w-full px-3 py-2 rounded-lg border border-slate-300 bg-white text-slate-900 text-sm font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div className="flex items-center gap-2">
                <input
                  name="isDefault"
                  type="checkbox"
                  id="bankDefault"
                  defaultChecked={editingBank?.isDefault}
                  className="w-4 h-4"
                />
                <label htmlFor="bankDefault" className="text-sm text-slate-700">ƒê·∫∑t l√†m th·∫ª m·∫∑c ƒë·ªãnh</label>
              </div>
              <div className="flex gap-3 pt-2">
                <button
                  type="button"
                  onClick={() => {
                    setShowAddBank(false);
                    setEditingBank(null);
                  }}
                  className="flex-1 py-2 rounded-lg bg-slate-100 text-slate-700 font-medium"
                >
                  H·ªßy
                </button>
                <button
                  type="submit"
                  className="flex-1 py-2 rounded-lg bg-blue-500 text-white font-medium"
                >
                  {editingBank ? 'C·∫≠p nh·∫≠t' : 'Th√™m'}
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      {/* Add/Edit USDT Wallet Form */}
      {(showAddUSDT || editingUSDT) && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4">
          <div className="w-full max-w-md rounded-2xl bg-white p-5 shadow-xl">
            <h3 className="text-lg font-semibold text-slate-900 mb-4">
              {editingUSDT ? 'S·ª≠a V√≠ USDT' : 'Th√™m V√≠ USDT'}
            </h3>
            <form onSubmit={(e) => {
              e.preventDefault();
              const formData = new FormData(e.currentTarget);
              const newWallet: USDTWallet = {
                id: editingUSDT?.id || Date.now().toString(),
                network: formData.get('network') as string,
                address: formData.get('address') as string,
                isDefault: usdtWallets.length === 0 || (formData.get('isDefault') === 'on')
              };
              
              if (editingUSDT) {
                setUsdtWallets(usdtWallets.map(w => w.id === editingUSDT.id ? newWallet : (newWallet.isDefault ? {...w, isDefault: false} : w)));
              } else {
                setUsdtWallets([...usdtWallets.map(w => newWallet.isDefault ? {...w, isDefault: false} : w), newWallet]);
              }
              setShowAddUSDT(false);
              setEditingUSDT(null);
            }} className="space-y-4">
              <div>
                <label htmlFor="network" className="block text-sm font-medium text-slate-700 mb-1">M·∫°ng l∆∞·ªõi</label>
                <select
                  id="network"
                  name="network"
                  required
                  defaultValue={editingUSDT?.network}
                  className="w-full px-3 py-2 rounded-lg border border-slate-300 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"
                >
                  <option value="">Ch·ªçn m·∫°ng</option>
                  <option value="TRC20">TRC20 (Tron)</option>
                  <option value="ERC20">ERC20 (Ethereum)</option>
                  <option value="BEP20">BEP20 (BSC)</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">ƒê·ªãa ch·ªâ v√≠</label>
                <input
                  name="address"
                  type="text"
                  required
                  defaultValue={editingUSDT?.address}
                  placeholder="VD: TXs8fK3Jx...9kL2mP4n"
                  className="w-full px-3 py-2 rounded-lg border border-slate-300 bg-white text-slate-900 text-sm font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500"
                />
              </div>
              <div className="flex items-center gap-2">
                <input
                  name="isDefault"
                  type="checkbox"
                  id="usdtDefault"
                  defaultChecked={editingUSDT?.isDefault}
                  className="w-4 h-4"
                />
                <label htmlFor="usdtDefault" className="text-sm text-slate-700">ƒê·∫∑t l√†m v√≠ m·∫∑c ƒë·ªãnh</label>
              </div>
              <div className="flex gap-3 pt-2">
                <button
                  type="button"
                  onClick={() => {
                    setShowAddUSDT(false);
                    setEditingUSDT(null);
                  }}
                  className="flex-1 py-2 rounded-lg bg-slate-100 text-slate-700 font-medium"
                >
                  H·ªßy
                </button>
                <button
                  type="submit"
                  className="flex-1 py-2 rounded-lg bg-green-500 text-white font-medium"
                >
                  {editingUSDT ? 'C·∫≠p nh·∫≠t' : 'Th√™m'}
                </button>
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

// ========== SUB-COMPONENTS ==========

// Transaction History View
const TransactionHistoryView: React.FC<{
  transactions: Transaction[];
  filter: "all" | Transaction["type"];
  onFilterChange: (filter: "all" | Transaction["type"]) => void;
  onBack: () => void;
  getTransactionIcon: (type: Transaction["type"]) => string;
  getStatusColor: (status: Transaction["status"]) => string;
  getStatusText: (status: Transaction["status"]) => string;
}> = ({ transactions, filter, onFilterChange, onBack, getTransactionIcon, getStatusColor, getStatusText }) => {
  return (
    <div className="flex-1 overflow-y-auto pb-24 bg-slate-100">
      <div className="sticky top-0 z-10 bg-white border-b border-slate-200">
        <div className="flex items-center gap-3 px-4 py-4">
          <button onClick={onBack} className="w-8 h-8 flex items-center justify-center" aria-label="Quay l·∫°i">
            <svg className="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1 className="text-lg font-semibold text-slate-900">L·ªãch s·ª≠ giao d·ªãch</h1>
        </div>
        
        {/* Filters */}
        <div className="flex gap-2 px-4 pb-3 overflow-x-auto">
          {[
            { key: "all", label: "T·∫•t c·∫£" },
            { key: "deposit", label: "N·∫°p ti·ªÅn" },
            { key: "withdraw", label: "R√∫t ti·ªÅn" },
            { key: "reward", label: "Th∆∞·ªüng" },
            { key: "fee", label: "Ph√≠" },
            { key: "internal", label: "N·ªôi b·ªô" }
          ].map((item) => (
            <button
              key={item.key}
              onClick={() => onFilterChange(item.key as any)}
              className={`px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap ${
                filter === item.key
                  ? "bg-blue-500 text-white"
                  : "bg-slate-200 text-slate-700"
              }`}
            >
              {item.label}
            </button>
          ))}
        </div>
      </div>

      <div className="p-4 space-y-2">
        {transactions.map((tx) => (
          <div key={tx.id} className="rounded-xl bg-white p-4 shadow-sm">
            <div className="flex items-start gap-3">
              <div className="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center flex-shrink-0">
                <span className="text-xl">{getTransactionIcon(tx.type)}</span>
              </div>
              <div className="flex-1 min-w-0">
                <div className="flex items-start justify-between gap-2 mb-1">
                  <p className="text-sm font-semibold text-slate-900">{tx.description}</p>
                  <p className={`text-sm font-bold ${tx.amount > 0 ? "text-green-600" : "text-red-600"}`}>
                    {tx.amount > 0 ? "+" : ""}{formatCurrency(tx.amount)}
                  </p>
                </div>
                <p className="text-xs text-slate-500 mb-2">M√£ GD: {tx.transactionCode}</p>
                <div className="flex items-center justify-between">
                  <span className="text-[11px] text-slate-400">{tx.time}</span>
                  <span className={`text-[10px] px-2 py-0.5 rounded-full font-medium ${getStatusColor(tx.status)}`}>
                    {getStatusText(tx.status)}
                  </span>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

// Financial Overview View
const FinancialOverviewView: React.FC<{
  data: FinancialData;
  onBack: () => void;
}> = ({ data, onBack }) => {
  const maxValue = Math.max(...data.chartData.map(d => Math.max(d.income, d.expense)));
  
  return (
    <div className="flex-1 overflow-y-auto pb-24 bg-slate-100">
      <div className="sticky top-0 z-10 bg-white border-b border-slate-200">
        <div className="flex items-center gap-3 px-4 py-4">
          <button onClick={onBack} className="w-8 h-8 flex items-center justify-center" aria-label="Quay l·∫°i">
            <svg className="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1 className="text-lg font-semibold text-slate-900">B√°o c√°o t√†i ch√≠nh</h1>
        </div>
      </div>

      <div className="p-4 space-y-4">
        {/* Summary Cards */}
        <div className="grid grid-cols-2 gap-3">
          <div className="rounded-xl bg-white p-4 shadow-sm">
            <p className="text-xs text-slate-500 mb-1">T·ªïng s·ªë d∆∞</p>
            <p className="text-lg font-bold text-slate-900">{formatCurrency(data.totalBalance)}</p>
          </div>
          <div className="rounded-xl bg-white p-4 shadow-sm">
            <p className="text-xs text-slate-500 mb-1">T·ªïng ƒë√£ n·∫°p</p>
            <p className="text-lg font-bold text-green-600">{formatCurrency(data.totalDeposit)}</p>
          </div>
          <div className="rounded-xl bg-white p-4 shadow-sm">
            <p className="text-xs text-slate-500 mb-1">T·ªïng ƒë√£ r√∫t</p>
            <p className="text-lg font-bold text-red-600">{formatCurrency(data.totalWithdraw)}</p>
          </div>
          <div className="rounded-xl bg-white p-4 shadow-sm">
            <p className="text-xs text-slate-500 mb-1">L√£i 7 ng√†y</p>
            <p className="text-lg font-bold text-blue-600">{formatCurrency(data.profit7Days)}</p>
          </div>
        </div>

        {/* 30 Days Profit */}
        <div className="rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 p-4 shadow-sm text-white">
          <p className="text-xs opacity-90 mb-1">L·ª£i nhu·∫≠n 30 ng√†y</p>
          <p className="text-2xl font-bold">{formatCurrency(data.profit30Days)}</p>
        </div>

        {/* Chart Summary */}
        <div className="rounded-xl bg-white p-4 shadow-sm">
          <h3 className="text-sm font-semibold text-slate-900 mb-3">D·ªØ li·ªáu thu/chi (7 ng√†y)</h3>
          <div className="space-y-2">
            {data.chartData.map((item, index) => (
              <div key={index} className="flex items-center gap-2">
                <span className="text-[10px] text-slate-500 w-12">{item.date}</span>
                <div className="flex-1 flex gap-1 h-6">
                  <div className="relative flex-1 bg-green-100 rounded overflow-hidden">
                    <div 
                      className="absolute inset-0 bg-green-400"
                      title={`Thu: ${formatCurrency(item.income)}`}
                    />
                  </div>
                  <div className="relative flex-1 bg-red-100 rounded overflow-hidden">
                    <div 
                      className="absolute inset-0 bg-red-400"
                      title={`Chi: ${formatCurrency(item.expense)}`}
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
          <div className="flex items-center justify-center gap-4 mt-3 text-xs">
            <div className="flex items-center gap-1">
              <div className="w-3 h-3 bg-green-400 rounded" />
              <span className="text-slate-600">Thu</span>
            </div>
            <div className="flex items-center gap-1">
              <div className="w-3 h-3 bg-red-400 rounded" />
              <span className="text-slate-600">Chi</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// Security Center View
const SecurityCenterView: React.FC<{
  settings: SecuritySettings;
  onUpdate: (settings: SecuritySettings) => void;
  onBack: () => void;
}> = ({ settings, onUpdate, onBack }) => {
  return (
    <div className="flex-1 overflow-y-auto pb-24 bg-slate-100">
      <div className="sticky top-0 z-10 bg-white border-b border-slate-200">
        <div className="flex items-center gap-3 px-4 py-4">
          <button onClick={onBack} className="w-8 h-8 flex items-center justify-center" aria-label="Quay l·∫°i">
            <svg className="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1 className="text-lg font-semibold text-slate-900">Trung t√¢m b·∫£o m·∫≠t</h1>
        </div>
      </div>

      <div className="p-4 space-y-3">
        {/* 2FA */}
        <div className="rounded-xl bg-white p-4 shadow-sm">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center">
                <span className="text-xl">üîê</span>
              </div>
              <div>
                <p className="text-sm font-semibold text-slate-900">X√°c th·ª±c 2 b∆∞·ªõc (2FA)</p>
                <p className="text-xs text-slate-500">
                  {settings.twoFactorEnabled ? "ƒê√£ b·∫≠t" : "Ch∆∞a b·∫≠t"}
                </p>
              </div>
            </div>
            <label className="relative inline-block w-12 h-6" title="B·∫≠t/t·∫Øt 2FA">
              <input
                type="checkbox"
                checked={settings.twoFactorEnabled}
                onChange={(e) => onUpdate({ ...settings, twoFactorEnabled: e.target.checked })}
                className="sr-only peer"
                aria-label="B·∫≠t/t·∫Øt x√°c th·ª±c 2 b∆∞·ªõc"
              />
              <span className="absolute inset-0 bg-slate-300 rounded-full peer-checked:bg-blue-500 transition-colors" />
              <span className="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-6" />
            </label>
          </div>
        </div>

        {/* Email Verification */}
        <div className="rounded-xl bg-white p-4 shadow-sm">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center">
                <span className="text-xl">üìß</span>
              </div>
              <div>
                <p className="text-sm font-semibold text-slate-900">X√°c minh Email</p>
                <p className="text-xs text-slate-500">
                  {settings.emailVerified ? "ƒê√£ x√°c minh" : "Ch∆∞a x√°c minh"}
                </p>
              </div>
            </div>
            {settings.emailVerified ? (
              <span className="text-green-600 text-xl">‚úì</span>
            ) : (
              <button className="px-3 py-1 rounded-lg bg-blue-500 text-white text-xs font-medium">
                X√°c minh
              </button>
            )}
          </div>
        </div>

        {/* Phone Verification */}
        <div className="rounded-xl bg-white p-4 shadow-sm">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center">
                <span className="text-xl">üì±</span>
              </div>
              <div>
                <p className="text-sm font-semibold text-slate-900">X√°c minh SƒêT</p>
                <p className="text-xs text-slate-500">
                  {settings.phoneVerified ? "ƒê√£ x√°c minh" : "Ch∆∞a x√°c minh"}
                </p>
              </div>
            </div>
            {settings.phoneVerified ? (
              <span className="text-green-600 text-xl">‚úì</span>
            ) : (
              <button className="px-3 py-1 rounded-lg bg-blue-500 text-white text-xs font-medium">
                X√°c minh
              </button>
            )}
          </div>
        </div>

        {/* Change Password */}
        <div className="rounded-xl bg-white p-4 shadow-sm">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-orange-100 flex items-center justify-center">
                <span className="text-xl">üîë</span>
              </div>
              <div>
                <p className="text-sm font-semibold text-slate-900">ƒê·ªïi m·∫≠t kh·∫©u</p>
                <p className="text-xs text-slate-500">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u t√†i kho·∫£n</p>
              </div>
            </div>
            <button className="px-3 py-1 rounded-lg bg-slate-200 text-slate-700 text-xs font-medium">
              ƒê·ªïi
            </button>
          </div>
        </div>

        {/* Daily Limit */}
        <div className="rounded-xl bg-white p-4 shadow-sm">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center">
              <span className="text-xl">üí≥</span>
            </div>
            <div>
              <p className="text-sm font-semibold text-slate-900">H·∫°n m·ª©c giao d·ªãch/ng√†y</p>
              <p className="text-xs text-slate-500">Gi·ªõi h·∫°n r√∫t ti·ªÅn m·ªói ng√†y</p>
            </div>
          </div>
          <div className="flex items-center gap-3">
            <input
              type="number"
              value={settings.dailyLimit}
              onChange={(e) => onUpdate({ ...settings, dailyLimit: Number(e.target.value) })}
              className="flex-1 px-3 py-2 rounded-lg border border-slate-300 bg-white text-slate-900 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500"
              title="H·∫°n m·ª©c giao d·ªãch h√†ng ng√†y"
              aria-label="H·∫°n m·ª©c giao d·ªãch h√†ng ng√†y"
            />
            <span className="text-sm text-slate-600">VND</span>
          </div>
          <p className="text-xs text-slate-500 mt-2">
            Hi·ªán t·∫°i: {formatCurrency(settings.dailyLimit)}
          </p>
        </div>
      </div>
    </div>
  );
};

// Receive Info View
const ReceiveInfoView: React.FC<{
  bankCards: BankCard[];
  usdtWallets: USDTWallet[];
  onBack: () => void;
}> = ({ bankCards, usdtWallets, onBack }) => {
  const defaultBank = bankCards.find(b => b.isDefault);
  const defaultUSDT = usdtWallets.find(w => w.isDefault);

  const copyToClipboard = (text: string, label: string) => {
    navigator.clipboard.writeText(text);
    alert(`ƒê√£ copy ${label}!`);
  };

  return (
    <div className="flex-1 overflow-y-auto pb-24 bg-slate-100">
      <div className="sticky top-0 z-10 bg-white border-b border-slate-200">
        <div className="flex items-center gap-3 px-4 py-4">
          <button onClick={onBack} className="w-8 h-8 flex items-center justify-center" aria-label="Quay l·∫°i">
            <svg className="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1 className="text-lg font-semibold text-slate-900">Th√¥ng tin nh·∫≠n ti·ªÅn</h1>
        </div>
      </div>

      <div className="p-4 space-y-4">
        {/* Bank Info */}
        {defaultBank && (
          <div className="rounded-xl bg-white p-4 shadow-sm">
            <div className="flex items-center gap-2 mb-3">
              <span className="text-2xl">üè¶</span>
              <h3 className="text-sm font-semibold text-slate-900">Th√¥ng tin ng√¢n h√†ng</h3>
            </div>
            <div className="space-y-2 mb-3">
              <div className="flex justify-between items-center">
                <span className="text-xs text-slate-500">Ng√¢n h√†ng:</span>
                <span className="text-sm font-semibold text-slate-900">{defaultBank.bankName}</span>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-xs text-slate-500">S·ªë TK:</span>
                <span className="text-sm font-mono text-slate-900">{defaultBank.accountNumber}</span>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-xs text-slate-500">Ch·ªß TK:</span>
                <span className="text-sm font-semibold text-slate-900">{defaultBank.accountName}</span>
              </div>
            </div>
            <div className="flex gap-2">
              <button
                onClick={() => copyToClipboard(defaultBank.accountNumber, "s·ªë t√†i kho·∫£n")}
                className="flex-1 py-2 rounded-lg bg-blue-500 text-white text-xs font-medium"
              >
                Copy s·ªë TK
              </button>
              <button
                onClick={() => alert("(DEMO) T·∫°o QR code ng√¢n h√†ng")}
                className="flex-1 py-2 rounded-lg bg-slate-200 text-slate-700 text-xs font-medium"
              >
                T·∫°o QR
              </button>
            </div>
          </div>
        )}

        {/* USDT Info */}
        {defaultUSDT && (
          <div className="rounded-xl bg-white p-4 shadow-sm">
            <div className="flex items-center gap-2 mb-3">
              <span className="text-2xl">üí∞</span>
              <h3 className="text-sm font-semibold text-slate-900">V√≠ USDT</h3>
            </div>
            <div className="space-y-2 mb-3">
              <div className="flex justify-between items-center">
                <span className="text-xs text-slate-500">M·∫°ng:</span>
                <span className="text-sm font-semibold text-slate-900">{defaultUSDT.network}</span>
              </div>
              <div>
                <span className="text-xs text-slate-500 block mb-1">ƒê·ªãa ch·ªâ:</span>
                <span className="text-xs font-mono text-slate-900 break-all">{defaultUSDT.address}</span>
              </div>
            </div>
            <div className="flex gap-2">
              <button
                onClick={() => copyToClipboard(defaultUSDT.address, "ƒë·ªãa ch·ªâ v√≠")}
                className="flex-1 py-2 rounded-lg bg-green-500 text-white text-xs font-medium"
              >
                Copy ƒë·ªãa ch·ªâ
              </button>
              <button
                onClick={() => alert("(DEMO) T·∫°o QR code USDT")}
                className="flex-1 py-2 rounded-lg bg-slate-200 text-slate-700 text-xs font-medium"
              >
                T·∫°o QR
              </button>
            </div>
          </div>
        )}

        {/* Instructions */}
        <div className="rounded-xl bg-blue-50 p-4">
          <p className="text-xs text-blue-900 font-medium mb-2">üí° L∆∞u √Ω khi nh·∫≠n ti·ªÅn</p>
          <ul className="text-xs text-blue-800 space-y-1 list-disc list-inside">
            <li>Ki·ªÉm tra k·ªπ th√¥ng tin tr∆∞·ªõc khi chia s·∫ª</li>
            <li>Ch·ªâ chia s·∫ª v·ªõi ng∆∞·ªùi g·ª≠i uy t√≠n</li>
            <li>QR code c√≥ hi·ªáu l·ª±c trong 15 ph√∫t</li>
            <li>Li√™n h·ªá h·ªó tr·ª£ n·∫øu ch·∫≠m nh·∫≠n ti·ªÅn</li>
          </ul>
        </div>
      </div>
    </div>
  );
};

// Login Logs View
const LoginLogsView: React.FC<{
  logs: LoginLog[];
  onBack: () => void;
}> = ({ logs, onBack }) => {
  return (
    <div className="flex-1 overflow-y-auto pb-24 bg-slate-100">
      <div className="sticky top-0 z-10 bg-white border-b border-slate-200">
        <div className="flex items-center gap-3 px-4 py-4">
          <button onClick={onBack} className="w-8 h-8 flex items-center justify-center" aria-label="Quay l·∫°i">
            <svg className="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1 className="text-lg font-semibold text-slate-900">Nh·∫≠t k√Ω ƒëƒÉng nh·∫≠p</h1>
        </div>
      </div>

      <div className="p-4 space-y-2">
        {logs.map((log) => (
          <div key={log.id} className="rounded-xl bg-white p-4 shadow-sm">
            <div className="flex items-start gap-3">
              <div className={`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${
                log.status === "success" ? "bg-green-100" : "bg-red-100"
              }`}>
                <span className="text-xl">{log.status === "success" ? "‚úì" : "‚úï"}</span>
              </div>
              <div className="flex-1">
                <div className="flex items-start justify-between mb-1">
                  <p className="text-sm font-semibold text-slate-900">{log.deviceName}</p>
                  <span className={`text-[10px] px-2 py-0.5 rounded-full font-medium ${
                    log.status === "success" 
                      ? "bg-green-100 text-green-700" 
                      : "bg-red-100 text-red-700"
                  }`}>
                    {log.status === "success" ? "Th√†nh c√¥ng" : "Th·∫•t b·∫°i"}
                  </span>
                </div>
                <p className="text-xs text-slate-500">IP: {log.ip}</p>
                <p className="text-xs text-slate-500">V·ªã tr√≠: {log.location}</p>
                <p className="text-[11px] text-slate-400 mt-1">{log.time}</p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <div className="p-4">
        <div className="rounded-xl bg-yellow-50 p-4">
          <p className="text-xs text-yellow-900 font-medium mb-2">‚ö†Ô∏è Ph√°t hi·ªán ho·∫°t ƒë·ªông b·∫•t th∆∞·ªùng?</p>
          <p className="text-xs text-yellow-800 mb-3">
            N·∫øu b·∫°n kh√¥ng th·ª±c hi·ªán c√°c ƒëƒÉng nh·∫≠p n√†y, vui l√≤ng ƒë·ªïi m·∫≠t kh·∫©u ngay l·∫≠p t·ª©c v√† li√™n h·ªá h·ªó tr·ª£.
          </p>
          <button className="w-full py-2 rounded-lg bg-yellow-600 text-white text-xs font-medium">
            B√°o c√°o ngay
          </button>
        </div>
      </div>
    </div>
  );
};

// Guide View
const GuideView: React.FC<{
  onBack: () => void;
}> = ({ onBack }) => {
  const [activeTab, setActiveTab] = useState<"deposit" | "withdraw">("deposit");

  return (
    <div className="flex-1 overflow-y-auto pb-24 bg-slate-100">
      <div className="sticky top-0 z-10 bg-white border-b border-slate-200">
        <div className="flex items-center gap-3 px-4 py-4">
          <button onClick={onBack} className="w-8 h-8 flex items-center justify-center" aria-label="Quay l·∫°i">
            <svg className="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1 className="text-lg font-semibold text-slate-900">H∆∞·ªõng d·∫´n</h1>
        </div>

        {/* Tabs */}
        <div className="flex px-4 pb-3 gap-2">
          <button
            onClick={() => setActiveTab("deposit")}
            className={`flex-1 py-2 rounded-lg text-sm font-medium ${
              activeTab === "deposit"
                ? "bg-blue-500 text-white"
                : "bg-slate-200 text-slate-700"
            }`}
          >
            N·∫°p ti·ªÅn
          </button>
          <button
            onClick={() => setActiveTab("withdraw")}
            className={`flex-1 py-2 rounded-lg text-sm font-medium ${
              activeTab === "withdraw"
                ? "bg-blue-500 text-white"
                : "bg-slate-200 text-slate-700"
            }`}
          >
            R√∫t ti·ªÅn
          </button>
        </div>
      </div>

      <div className="p-4 space-y-4">
        {activeTab === "deposit" ? (
          <>
            {/* Deposit Guide */}
            <div className="rounded-xl bg-white p-4 shadow-sm">
              <h3 className="text-sm font-semibold text-slate-900 mb-3">üì• C√°ch n·∫°p ti·ªÅn</h3>
              <ol className="space-y-2 text-sm text-slate-700">
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">1.</span>
                  <span>Nh·∫•n n√∫t "N·∫°p Ti·ªÅn" tr√™n m√†n h√¨nh V√≠</span>
                </li>
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">2.</span>
                  <span>Ch·ªçn ph∆∞∆°ng th·ª©c: Ng√¢n h√†ng ho·∫∑c USDT</span>
                </li>
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">3.</span>
                  <span>Nh·∫≠p s·ªë ti·ªÅn c·∫ßn n·∫°p v√† x√°c nh·∫≠n</span>
                </li>
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">4.</span>
                  <span>Chuy·ªÉn kho·∫£n theo th√¥ng tin hi·ªÉn th·ªã</span>
                </li>
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">5.</span>
                  <span>Ch·ªù x√°c nh·∫≠n (5-15 ph√∫t)</span>
                </li>
              </ol>
            </div>

            <div className="rounded-xl bg-green-50 p-4">
              <p className="text-xs text-green-900 font-medium mb-2">üí° L∆∞u √Ω quan tr·ªçng</p>
              <ul className="text-xs text-green-800 space-y-1 list-disc list-inside">
                <li>Ghi ƒë√∫ng n·ªôi dung chuy·ªÉn kho·∫£n</li>
                <li>Kh√¥ng n·∫°p d∆∞·ªõi m·ª©c t·ªëi thi·ªÉu (100,000 VND)</li>
                <li>L∆∞u bi√™n lai giao d·ªãch</li>
                <li>USDT: Ki·ªÉm tra ƒë√∫ng m·∫°ng (TRC20/ERC20)</li>
              </ul>
            </div>

            <div className="rounded-xl bg-white p-4 shadow-sm">
              <h3 className="text-sm font-semibold text-slate-900 mb-3">‚ùì L√Ω do ch·∫≠m x·ª≠ l√Ω</h3>
              <ul className="space-y-2 text-xs text-slate-700">
                <li>‚Ä¢ Ng√¢n h√†ng x·ª≠ l√Ω ch·∫≠m (gi·ªù cao ƒëi·ªÉm)</li>
                <li>‚Ä¢ Sai n·ªôi dung chuy·ªÉn kho·∫£n</li>
                <li>‚Ä¢ S·ªë ti·ªÅn kh√¥ng kh·ªõp</li>
                <li>‚Ä¢ Giao d·ªãch USDT ch∆∞a ƒë·ªß x√°c nh·∫≠n</li>
              </ul>
            </div>
          </>
        ) : (
          <>
            {/* Withdraw Guide */}
            <div className="rounded-xl bg-white p-4 shadow-sm">
              <h3 className="text-sm font-semibold text-slate-900 mb-3">üì§ C√°ch r√∫t ti·ªÅn</h3>
              <ol className="space-y-2 text-sm text-slate-700">
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">1.</span>
                  <span>Nh·∫•n n√∫t "R√∫t Ti·ªÅn" tr√™n m√†n h√¨nh V√≠</span>
                </li>
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">2.</span>
                  <span>Ch·ªçn t√†i kho·∫£n/v√≠ nh·∫≠n ti·ªÅn</span>
                </li>
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">3.</span>
                  <span>Nh·∫≠p s·ªë ti·ªÅn mu·ªën r√∫t</span>
                </li>
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">4.</span>
                  <span>X√°c th·ª±c OTP/2FA n·∫øu c√≥</span>
                </li>
                <li className="flex gap-2">
                  <span className="font-bold text-blue-600">5.</span>
                  <span>Ch·ªù duy·ªát v√† chuy·ªÉn ti·ªÅn (1-24h)</span>
                </li>
              </ol>
            </div>

            <div className="rounded-xl bg-yellow-50 p-4">
              <p className="text-xs text-yellow-900 font-medium mb-2">‚ö†Ô∏è ƒêi·ªÅu ki·ªán r√∫t ti·ªÅn</p>
              <ul className="text-xs text-yellow-800 space-y-1 list-disc list-inside">
                <li>T√†i kho·∫£n ƒë√£ x√°c minh ƒë·∫ßy ƒë·ªß</li>
                <li>S·ªë d∆∞ kh·∫£ d·ª•ng ƒë·ªß (kh√¥ng t√≠nh s·ªë b·ªã kh√≥a)</li>
                <li>Kh√¥ng v∆∞·ª£t h·∫°n m·ª©c ng√†y</li>
                <li>Kh√¥ng c√≥ giao d·ªãch ƒëang ch·ªù</li>
              </ul>
            </div>

            <div className="rounded-xl bg-white p-4 shadow-sm">
              <h3 className="text-sm font-semibold text-slate-900 mb-3">üö´ L·ªói th∆∞·ªùng g·∫∑p</h3>
              <div className="space-y-3">
                <div>
                  <p className="text-xs font-semibold text-slate-900">Kh√¥ng ƒë·ªß s·ªë d∆∞ kh·∫£ d·ª•ng</p>
                  <p className="text-xs text-slate-600">‚Üí Ch·ªù giao d·ªãch ƒëang ch·ªù ho√†n t·∫•t</p>
                </div>
                <div>
                  <p className="text-xs font-semibold text-slate-900">V∆∞·ª£t h·∫°n m·ª©c ng√†y</p>
                  <p className="text-xs text-slate-600">‚Üí R√∫t v√†o ng√†y h√¥m sau ho·∫∑c li√™n h·ªá tƒÉng h·∫°n m·ª©c</p>
                </div>
                <div>
                  <p className="text-xs font-semibold text-slate-900">Th√¥ng tin TK kh√¥ng h·ª£p l·ªá</p>
                  <p className="text-xs text-slate-600">‚Üí Ki·ªÉm tra l·∫°i th√¥ng tin th·∫ª/v√≠ ƒë√£ li√™n k·∫øt</p>
                </div>
              </div>
            </div>
          </>
        )}

        {/* Contact Support */}
        <div className="rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 p-4 text-white">
          <p className="text-sm font-semibold mb-2">üí¨ C·∫ßn h·ªó tr·ª£ th√™m?</p>
          <p className="text-xs mb-3">ƒê·ªôi ng≈© h·ªó tr·ª£ 24/7 s·∫µn s√†ng gi√∫p b·∫°n</p>
          <div className="flex gap-2">
            <button className="flex-1 py-2 rounded-lg bg-white text-blue-600 text-xs font-medium">
              Chat Zalo
            </button>
            <button className="flex-1 py-2 rounded-lg bg-white/20 text-white text-xs font-medium">
              G·ªçi Hotline
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default WalletScreen;
